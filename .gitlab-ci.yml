# Dynamic child pipelines
# https://docs.gitlab.com/ee/ci/parent_child_pipelines.html#dynamic-child-pipelines

generate-config:
  stage: build
  variables:
    GIT_SUBMODULE_STRATEGY: none
  artifacts:
    paths:
      - generated-config.yml
  script:
    - if test -e .gitlab-ci.d/${CI_PROJECT_NAMESPACE}.yml ;
      then
        cp .gitlab-ci.d/${CI_PROJECT_NAMESPACE}.yml generated-config.yml ;
      else
        cp .gitlab-ci.d/qemu-project.yml generated-config.yml ;
      fi

generate-pipeline:
  stage: test
  variables:
    GIT_SUBMODULE_STRATEGY: none
  trigger:
    include:
      - artifact: generated-config.yml
        job: generate-config
