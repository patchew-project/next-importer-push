.cross_common_job:
  stage: build
  image: $CI_REGISTRY_IMAGE/qemu/$IMAGE:latest
  rules:
    # If the if statement is true, the job is excluded from a pipeline.
    - if: $SKIP_BUILD =~ /cross/
      when: never
    - if: $CI_JOB_NAME =~ /system/ && $SKIP_BUILD =~ /system/
      when: never
    - if: $CI_JOB_NAME =~ /user/ && $SKIP_BUILD =~ /user/
      when: never
    # In all other cases, the job is added to the pipeline.
    - when: on_success

.cross_system_build_job:
  extends: .cross_common_job
  timeout: 80m
  script:
    - mkdir build
    - cd build
    - PKG_CONFIG_PATH=$PKG_CONFIG_PATH
      ../configure --enable-werror $QEMU_CONFIGURE_OPTS --disable-user
        --target-list-exclude="aarch64-softmmu i386-softmmu microblaze-softmmu
          mips-softmmu mipsel-softmmu mips64-softmmu ppc64-softmmu sh4-softmmu
          xtensa-softmmu"
    - make -j$(expr $(nproc) + 1) all check-build

.cross_user_build_job:
  extends: .cross_common_job
  script:
    - mkdir build
    - cd build
    - PKG_CONFIG_PATH=$PKG_CONFIG_PATH
      ../configure --enable-werror $QEMU_CONFIGURE_OPTS --disable-system
    - make -j$(expr $(nproc) + 1) all check-build

cross-armel-system:
  extends: .cross_system_build_job
  variables:
    IMAGE: debian-armel-cross

cross-armel-user:
  extends: .cross_user_build_job
  variables:
    IMAGE: debian-armel-cross

cross-armhf-system:
  extends: .cross_system_build_job
  variables:
    IMAGE: debian-armhf-cross

cross-armhf-user:
  extends: .cross_user_build_job
  variables:
    IMAGE: debian-armhf-cross

cross-arm64-system:
  extends: .cross_system_build_job
  variables:
    IMAGE: debian-arm64-cross

cross-arm64-user:
  extends: .cross_user_build_job
  variables:
    IMAGE: debian-arm64-cross

cross-mips-system:
  extends: .cross_system_build_job
  variables:
    IMAGE: debian-mips-cross

cross-mips-user:
  extends: .cross_user_build_job
  variables:
    IMAGE: debian-mips-cross

cross-mipsel-system:
  extends: .cross_system_build_job
  variables:
    IMAGE: debian-mipsel-cross

cross-mipsel-user:
  extends: .cross_user_build_job
  variables:
    IMAGE: debian-mipsel-cross

cross-mips64el-system:
  extends: .cross_system_build_job
  variables:
    IMAGE: debian-mips64el-cross

cross-mips64el-user:
  extends: .cross_user_build_job
  variables:
    IMAGE: debian-mips64el-cross

cross-ppc64el-system:
  extends: .cross_system_build_job
  variables:
    IMAGE: debian-ppc64el-cross

cross-ppc64el-user:
  extends: .cross_user_build_job
  variables:
    IMAGE: debian-ppc64el-cross

cross-s390x-system:
  extends: .cross_system_build_job
  variables:
    IMAGE: debian-s390x-cross

cross-s390x-user:
  extends: .cross_user_build_job
  variables:
    IMAGE: debian-s390x-cross

cross-win32-system:
  extends: .cross_system_build_job
  variables:
    IMAGE: fedora-win32-cross

cross-win64-system:
  extends: .cross_system_build_job
  variables:
    IMAGE: fedora-win64-cross
